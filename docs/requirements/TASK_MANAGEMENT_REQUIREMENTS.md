# 任务管理功能需求说明书 (v1.0)

## 1. 功能概述 (Feature Overview)

任务管理功能旨在让用户能够创建、组织和跟踪与番茄工作法相关的任务。用户可以将具体的任务与每个番茄时段关联，从而清晰地了解自己的工作内容和进度，最终通过统计分析功能复盘工作效率。

## 2. 核心功能需求 (Core Functional Requirements)

### REQ-TM-001: 创建新任务
- **描述:** 用户应能快速添加一个新任务。
- **子需求:**
    - **REQ-TM-001.1 (标题):** 任务创建界面必须包含一个文本输入框用于填写任务**标题** (必填项)。
    - **REQ-TM-001.2 (描述):** 提供一个多行文本区域用于填写任务的详细**描述** (选填项)。
    - **REQ-TM-001.3 (预估番茄数):** 用户可以设置完成此任务预估需要多少个番茄时段 (例如，使用 `+` / `-` 按钮，默认为1)。
    - **REQ-TM-001.4 (优先级):** 用户可以为任务设置**优先级** (高、中、低)，默认为“中”。
    - **REQ-TM-001.5 (保存):** 点击“保存”或“添加”按钮后，新任务应立即出现在任务列表中。

### REQ-TM-002: 查看任务列表
- **描述:** 用户需要一个清晰的界面来查看所有任务。
- **子需求:**
    - **REQ-TM-002.1 (信息展示):** 任务列表中的每一项都应清晰展示任务**标题**、**已用/预估番茄数** (如 `1/3`) 和**优先级** (通过颜色或图标区分)。
    - **REQ-TM-002.2 (完成状态):** 已完成的任务应有明显的视觉区分，例如标题带有删除线、整体变灰。
    - **REQ-TM-002.3 (排序):** 任务列表应支持按**创建时间** (默认)、**优先级**进行排序。
    - **REQ-TM-002.4 (过滤):** 提供按任务状态 (全部、待办、已完成) 过滤任务列表的功能。

### REQ-TM-003: 编辑任务
- **描述:** 用户可以修改已创建任务的详细信息。
- **子需求:**
    - **REQ-TM-003.1 (入口):** 任务列表中的每个任务项都应提供一个“编辑”入口。
    - **REQ-TM-003.2 (编辑内容):** 用户可以修改任务的**标题**、**描述**、**预估番茄数**和**优先级**。
    - **REQ-TM-003.3 (保存生效):** 修改保存后，任务列表应立即显示更新后的信息。

### REQ-TM-004: 删除任务
- **描述:** 用户可以从列表中移除不再需要的任务。
- **子需求:**
    - **REQ-TM-004.1 (删除操作):** 每个任务项都应提供“删除”操作。
    - **REQ-TM-004.2 (确认机制):** 为防止误操作，执行删除前必须弹出一个**确认对话框**。

### REQ-TM-005: 标记任务完成/未完成
- **描述:** 用户可以快速切换任务的完成状态。
- **子需求:**
    - **REQ-TM-005.1 (操作控件):** 每个任务项前应提供一个**复选框 (Checkbox)** 来标记任务的完成状态。
    - **REQ-TM-005.2 (状态切换):** 点击复选框可以方便地在“已完成”和“待办”状态之间切换。

## 3. 与计时器集成需求 (Integration Requirements)

### REQ-TM-006: 关联当前任务
- **描述:** 用户在开始计时前，可以选择一个任务作为当前专注的目标。
- **子需求:**
    - **REQ-TM-006.1 (任务选择):** 在计时器主界面，用户可以从任务列表中选择一个“待办”任务作为当前要执行的任务。
    - **REQ-TM-006.2 (当前任务显示):** 计时器启动后，主界面应清晰地显示**当前正在进行的任务标题**。
    - **REQ-TM-006.3 (无任务计时):** 如果用户不选择任何任务，计时器仍可以独立运行，记录为“未指定任务”的番茄时段。

### REQ-TM-007: 自动更新任务进度
- **描述:** 当一个番茄时段完成时，系统应自动更新所关联任务的进度。
- **子需求:**
    - **REQ-TM-007.1 (番茄数更新):** 每完成一个与任务关联的工作番茄时段，该任务的“已用番茄数”应**自动加1**。
    - **REQ-TM-007.2 (自动完成建议):** 当任务的“已用番茄数”达到“预估番茄数”时，系统可以给用户一个提示，询问是否将此任务标记为“已完成”。

## 4. 非功能性需求 (Non-Functional Requirements)

### REQ-NFR-TM-001: 设计与体验
- **描述:** 任务管理界面的设计和交互体验需与应用整体保持一致。
- **子需求:**
    - **REQ-NFR-TM-001.1 (设计风格):** 严格遵循 **iOS 18 设计语言**，包括字体、颜色、间距和控件样式。
    - **REQ-NFR-TM-001.2 (动画效果):** 添加、删除、排序等操作应有流畅的**过渡动画** (使用 Framer Motion)。
    - **REQ-NFR-TM-001.3 (响应式):** 完美适配主流移动设备屏幕。

### REQ-NFR-TM-002: 数据持久化
- **描述:** 用户的任务数据必须在本地持久化保存。
- **子需求:**
    - **REQ-NFR-TM-002.1 (本地存储):** 所有任务数据应通过现有的 **Zustand persist middleware** 保存到 `localStorage` 或 `IndexedDB`。
    - **REQ-NFR-TM-002.2 (数据一致性):** 刷新页面或重新打开应用后，任务列表和状态应完整恢复。

### REQ-NFR-TM-003: API 服务
- **描述:** 后端 API 需完整支持任务管理的 CRUD 操作。
- **子需求:**
    - **REQ-NFR-TM-003.1 (API 实现):** 全面实现 `/api/tasks` 和 `/api/tasks/[id]` 路由的 `GET`, `POST`, `PUT`, `DELETE` 逻辑，使其能真正处理数据，而不仅仅是返回模拟数据。
